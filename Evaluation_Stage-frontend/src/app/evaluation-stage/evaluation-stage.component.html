<div class="container my-5 p-4 bg-white shadow rounded">
  <header class="mb-4">
    <h1 class="h4 text-center fw-bold">Évaluation Stage Étudiants <br> Appréciation du Tuteur de Stage</h1>
    <div class="text-center mb-3">
      <span class="badge bg-primary">Étape {{currentStep}}/{{totalSteps}}</span>
    </div>
  </header>

  <!-- Add alert container just after header -->
  <div class="alert alert-{{alertType}} alert-dismissible fade show" role="alert" *ngIf="showAlert">
    {{alertMessage}}
    <button type="button" class="btn-close" (click)="showAlert = false" aria-label="Close"></button>
  </div>

  <form (ngSubmit)="onSubmit()">
    <!-- Section 1 -->
    <section *ngIf="currentStep === 1" class="mb-5">
      <div class="container p-4">
        <div class="p-3 border bg-light">
          <!-- Informations Stagiaire -->
          <div class="row g-3 mb-4">

            <!-- Nom et Prénom du stagiaire -->
            <div class="col-md-3">
              <label class="form-label">Nom du stagiaire :</label>
              <input type="text" class="form-control" [(ngModel)]="formData.stagiaire.nom" name="stagiaireNom">
            </div>
            <div class="col-md-3">
              <label class="form-label">Prénom du stagiaire :</label>
              <input type="text" class="form-control" [(ngModel)]="formData.stagiaire.prenom" name="stagiairePrenom">
            </div>

            <!-- Institution du stagiaire -->
            <div class="col-md-6">
              <label class="form-label">Institution du stagiaire :</label>
              <input type="text" class="form-control" [(ngModel)]="formData.stagiaire.institution" name="stagiaireInstitution">
            </div>

            <!-- Email du stagiaire -->
            <div class="col-md-6">
              <label class="form-label">Email du stagiaire :</label>
              <input type="email" class="form-control" [(ngModel)]="formData.stagiaire.email" name="stagiaireEmail">
            </div>

            <!-- Nom de l’entreprise -->
            <div class="col-md-6">
              <label class="form-label">Nom de l’entreprise :</label>
              <input type="text" class="form-control" [(ngModel)]="formData.stage.entreprise" name="entreprise">
            </div>

            <!-- Nom et Prénom du tuteur -->
            <div class="col-md-3">
              <label class="form-label">Nom du tuteur :</label>
              <input type="text" class="form-control" [(ngModel)]="formData.tuteur.nom" name="tuteurNom">
            </div>
            <div class="col-md-3">
              <label class="form-label">Prénom du tuteur :</label>
              <input type="text" class="form-control" [(ngModel)]="formData.tuteur.prenom" name="tuteurPrenom">
            </div>

            <!-- Email du tuteur -->
            <div class="col-md-6">
              <label class="form-label">Email du tuteur :</label>
              <input type="email" class="form-control" [(ngModel)]="formData.tuteur.email" name="tuteurEmail">
            </div>

            <!-- Période du stage -->
            <div class="col-md-6">
              <label class="form-label">Période du stage du</label>
              <div class="row g-2">
                <div class="col-6">
                  <input type="date" class="form-control" [(ngModel)]="formData.periode.db" name="periodeDebut">
                </div>
                <div class="col-6">
                  <input type="date" class="form-control" [(ngModel)]="formData.periode.df" name="periodeFin">
                </div>
              </div>
            </div>
          </div>

          <!-- Thème du projet -->
          <div class="mb-4">
            <label class="form-label fw-bold">THÈME DU PROJET PRINCIPAL CONFIE A L’ÉTUDIANT(E)</label>
            <textarea class="form-control" [(ngModel)]="formData.stage.description" name="description" rows="2"></textarea>
          </div>

          <!-- Objectifs -->
          <div class="mb-2">
            <label class="form-label fw-bold">OBJECTIFS ASSIGNES A L’ÉTUDIANT(E)</label>
            <textarea class="form-control" [(ngModel)]="formData.stage.objectif" name="objectif" rows="2"></textarea>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 2 -->
    <section *ngIf="currentStep === 2" class="mb-5">
      <h2 class="h5 fw-semibold mb-4">Appreciations Globales sur l'Étudiant(e)</h2>
      <div class="card p-3 mb-4">
        <div class="mb-4">
          <div class="p-3 border bg-light">
            <h3 class="h6 fw-medium">Implication dans ses activités</h3>
            <div class="d-flex flex-wrap gap-3 mt-2">
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="implication" [value]="'Paresseux'" [(ngModel)]="radioValues.implication">
                <label class="form-check-label" for="imp1">Paresseux</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="implication" [value]="'Le juste nécessaire'" [(ngModel)]="radioValues.implication">
                <label class="form-check-label" for="imp2">Le juste nécessaire</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="implication" [value]="'Bonne'" [(ngModel)]="radioValues.implication">
                <label class="form-check-label" for="imp3">Bonne</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="implication" [value]="'Très forte'" [(ngModel)]="radioValues.implication">
                <label class="form-check-label" for="imp4">Très forte</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="implication" [value]="'Dépasse ses objectifs'" [(ngModel)]="radioValues.implication">
                <label class="form-check-label" for="imp5">Dépasse ses objectifs</label>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-4">
          <div class="p-3 border bg-light">
            <h3 class="h6 fw-medium">Ouverture aux autres</h3>
            <div class="d-flex flex-wrap gap-3 mt-2">
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="ouverture" [value]="'Isolé(e) ou en opposition'" [(ngModel)]="radioValues.ouverture">
                <label class="form-check-label" for="ouv1">Isolé(e) ou en opposition</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="ouverture" [value]="'Renfermé(e) ou obtus'" [(ngModel)]="radioValues.ouverture">
                <label class="form-check-label" for="ouv2">Renfermé(e) ou obtus</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="ouverture" [value]="'Bonne'" [(ngModel)]="radioValues.ouverture">
                <label class="form-check-label" for="ouv3">Bonne</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="ouverture" [value]="'Très bonne'" [(ngModel)]="radioValues.ouverture">
                <label class="form-check-label" for="ouv4">Très bonne</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="ouverture" [value]="'Excellente'" [(ngModel)]="radioValues.ouverture">
                <label class="form-check-label" for="ouv5">Excellente</label>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-4">
          <div class="p-3 border bg-light">
            <h3 class="h6 fw-medium">Qualité de ses productions</h3>
            <div class="d-flex flex-wrap gap-3 mt-2">
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="qualite" [value]="'Médiocre'" [(ngModel)]="radioValues.qualite">
                <label class="form-check-label" for="qual1">Médiocre</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="qualite" [value]="'Acceptable'" [(ngModel)]="radioValues.qualite">
                <label class="form-check-label" for="qual2">Acceptable</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="qualite" [value]="'Bonne'" [(ngModel)]="radioValues.qualite">
                <label class="form-check-label" for="qual3">Bonne</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="qualite" [value]="'Très bonne'" [(ngModel)]="radioValues.qualite">
                <label class="form-check-label" for="qual4">Très bonne</label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="qualite" [value]="'Très professionnelle'" [(ngModel)]="radioValues.qualite">
                <label class="form-check-label" for="qual5">Très professionnelle</label>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Observations sur l'ensemble du travail accompli</label>
          <textarea class="form-control" rows="4" placeholder="Observations" [(ngModel)]="observations" name="observations"></textarea>
        </div>
      </div>
    </section>

    <!-- Section 3 -->
    <section *ngIf="currentStep === 3" class="mb-5">
      <div class="p-3 border bg-light">
        <h2 class="h5 fw-semibold mb-3">Evaluations des Compétences de l'Étudiant(e)</h2>
        <p>Pour chaque compétence, les niveaux possibles sont : </p>
        <p class="text-muted small mb-4">NA : Non applicable, Compétence on appliquée , ou trop peu</p>
        <p class="text-muted small mb-4">DEBUTANT : Applique avec aide, les savoir</p>
        <p class="text-muted small mb-4">AUTONOME : Applique de façon autonome,</p>
        <p class="text-muted small mb-4">AUTONOME +: Résout des problèmes selon la situaton de travail - A un jugement critique pour anticiper ou s'adapt.</p>
      </div>
      <div class="mb-4">
        <div class="p-3 border bg-light">
          <h3 class="h6 fw-medium">Compétences liées à l'individu (cocher les cases)</h3>
          <div class="table-responsive mt-2">
            <table class="table table-bordered align-middle text-center">
              <thead class="table-light">
              <tr>
                <th scope="col">Compétence</th>
                <th scope="col">NA</th>
                <th scope="col">DEBUTANT</th>
                <th scope="col">AUTONOME</th>
                <th scope="col">AUTONOME +</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td> Etre capable d'analyse et de synthèse </td>
                <td><input class="form-check-input" type="radio" name="indiv1" [value]="'NA'" [(ngModel)]="radioValues.indiv1"></td>
                <td><input class="form-check-input" type="radio" name="indiv1" [value]="'DEBUTANT'" [(ngModel)]="radioValues.indiv1"></td>
                <td><input class="form-check-input" type="radio" name="indiv1" [value]="'AUTONOME'" [(ngModel)]="radioValues.indiv1"></td>
                <td><input class="form-check-input" type="radio" name="indiv1" [value]="'AUTONOME+'" [(ngModel)]="radioValues.indiv1"></td>
              </tr>
              <tr>
                <td>Etre capable de proposer des méthodes et des axes de travail</td>
                <td><input class="form-check-input" type="radio" name="indiv2" [value]="'NA'" [(ngModel)]="radioValues.indiv2"></td>
                <td><input class="form-check-input" type="radio" name="indiv2" [value]="'DEBUTANT'" [(ngModel)]="radioValues.indiv2"></td>
                <td><input class="form-check-input" type="radio" name="indiv2" [value]="'AUTONOME'" [(ngModel)]="radioValues.indiv2"></td>
                <td><input class="form-check-input" type="radio" name="indiv2" [value]="'AUTONOME+'" [(ngModel)]="radioValues.indiv2"></td>
              </tr>
              <tr>
                <td>Etre capable faire adhérer les acteurs</td>
                <td><input class="form-check-input" type="radio" name="indiv3" [value]="'NA'" [(ngModel)]="radioValues.indiv3"></td>
                <td><input class="form-check-input" type="radio" name="indiv3" [value]="'DEBUTANT'" [(ngModel)]="radioValues.indiv3"></td>
                <td><input class="form-check-input" type="radio" name="indiv3" [value]="'AUTONOME'" [(ngModel)]="radioValues.indiv3"></td>
                <td><input class="form-check-input" type="radio" name="indiv3" [value]="'AUTONOME+'" [(ngModel)]="radioValues.indiv3"></td>
              </tr>
              <tr>
                <td>Etre capable de s'autoévaluer</td>
                <td><input class="form-check-input" type="radio" name="indiv4" [value]="'NA'" [(ngModel)]="radioValues.indiv4"></td>
                <td><input class="form-check-input" type="radio" name="indiv4" [value]="'DEBUTANT'" [(ngModel)]="radioValues.indiv4"></td>
                <td><input class="form-check-input" type="radio" name="indiv4" [value]="'AUTONOME'" [(ngModel)]="radioValues.indiv4"></td>
                <td><input class="form-check-input" type="radio" name="indiv4" [value]="'AUTONOME+'" [(ngModel)]="radioValues.indiv4"></td>
              </tr>
              <tr>
                <td>Etre capable d'identifier des problèmes complexes</td>
                <td><input class="form-check-input" type="radio" name="indiv5" [value]="'NA'" [(ngModel)]="radioValues.indiv5"></td>
                <td><input class="form-check-input" type="radio" name="indiv5" [value]="'DEBUTANT'" [(ngModel)]="radioValues.indiv5"></td>
                <td><input class="form-check-input" type="radio" name="indiv5" [value]="'AUTONOME'" [(ngModel)]="radioValues.indiv5"></td>
                <td><input class="form-check-input" type="radio" name="indiv5" [value]="'AUTONOME+'" [(ngModel)]="radioValues.indiv5"></td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="p-3 border bg-light">
          <div class="mb-3">
            <label class="form-label">Note pour évaluer les compétences liées à l'individu.
              <br>
              cette note complète les évaluations qualitatives sans en etre la conversion directe
              <br>
              Donnez une note sur 20
            </label>
            <input type="number" class="form-control w-auto" min="0" max="20" [(ngModel)]="notes.individu" name="noteIndividu" placeholder="0 - 20">
          </div>
        </div>
      </div>
    </section>

    <!-- Section 4 -->
    <section *ngIf="currentStep === 4" class="mb-5">
      <div class="mb-4">
        <div class="p-3 border bg-light">
          <h3 class="h6 fw-medium">Compétences liées à l'entreprise (cocher les cases)</h3>
          <div class="table-responsive mt-2">
            <table class="table table-bordered align-middle text-center">
              <thead class="table-light">
              <tr>
                <th scope="col">Compétence</th>
                <th scope="col">NA</th>
                <th scope="col">DEBUTANT</th>
                <th scope="col">AUTONOME</th>
                <th scope="col">AUTONOME +</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td>Etre capable d'analyser le fonctionnement de l'entreprise d'accueil</td>
                <td><input class="form-check-input" type="radio" name="company1" [value]="'NA'" [(ngModel)]="radioValues.company1"></td>
                <td><input class="form-check-input" type="radio" name="company1" [value]="'DEBUTANT'" [(ngModel)]="radioValues.company1"></td>
                <td><input class="form-check-input" type="radio" name="company1" [value]="'AUTONOME'" [(ngModel)]="radioValues.company1"></td>
                <td><input class="form-check-input" type="radio" name="company1" [value]="'AUTONOME+'" [(ngModel)]="radioValues.company1"></td>
              </tr>
              <tr>
                <td> Etre capable d'analyse la démarche projet , et de structurer un projet</td>
                <td><input class="form-check-input" type="radio" name="company2" [value]="'NA'" [(ngModel)]="radioValues.company2"></td>
                <td><input class="form-check-input" type="radio" name="company2" [value]="'DEBUTANT'" [(ngModel)]="radioValues.company2"></td>
                <td><input class="form-check-input" type="radio" name="company2" [value]="'AUTONOME'" [(ngModel)]="radioValues.company2"></td>
                <td><input class="form-check-input" type="radio" name="company2" [value]="'AUTONOME+'" [(ngModel)]="radioValues.company2"></td>
              </tr>
              <tr>
                <td>Etre capable d'apprendre à déceler et à comprendre  la politique environnementale de l'entreprise</td>
                <td><input class="form-check-input" type="radio" name="company3" [value]="'NA'" [(ngModel)]="radioValues.company3"></td>
                <td><input class="form-check-input" type="radio" name="company3" [value]="'DEBUTANT'" [(ngModel)]="radioValues.company3"></td>
                <td><input class="form-check-input" type="radio" name="company3" [value]="'AUTONOME'" [(ngModel)]="radioValues.company3"></td>
                <td><input class="form-check-input" type="radio" name="company3" [value]="'AUTONOME+'" [(ngModel)]="radioValues.company3"></td>
              </tr>
              <tr>
                <td>Etre capable de rechercher et sélectionner l'information nécessaire à ses activités</td>
                <td><input class="form-check-input" type="radio" name="company4" [value]="'NA'" [(ngModel)]="radioValues.company4"></td>
                <td><input class="form-check-input" type="radio" name="company4" [value]="'DEBUTANT'" [(ngModel)]="radioValues.company4"></td>
                <td><input class="form-check-input" type="radio" name="company4" [value]="'AUTONOME'" [(ngModel)]="radioValues.company4"></td>
                <td><input class="form-check-input" type="radio" name="company4" [value]="'AUTONOME+'" [(ngModel)]="radioValues.company4"></td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="p-3 border bg-light">
          <div class="mt-3">
            <label class="form-label">Note pour les compétences liées à l'entreprise
              <br>
              Donnez une note sur 20
            </label>
            <input type="number" class="form-control w-auto" min="0" max="20" [(ngModel)]="notes.entreprise" name="noteEntreprise" placeholder="0 - 20">
          </div>
        </div>
      </div>
    </section>

    <!-- Section 5 -->
    <section *ngIf="currentStep === 5" class="mb-5">
      <div class="mb-4">
        <div class="p-3 border bg-light">
          <h3 class="h6 fw-medium">Compétences scientifiques et techniques (cocher les cases)</h3>
          <div class="table-responsive mt-2">
            <table class="table table-bordered align-middle text-center">
              <thead class="table-light">
              <tr>
                <th scope="col">Compétence</th>
                <th scope="col">NA</th>
                <th scope="col">DEBUTANT</th>
                <th scope="col">AUTONOME</th>
                <th scope="col">AUTONOME +</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td>Etre capable d'assurer la Conception préliminaire de produits/services / processus</td>
                <td><input class="form-check-input" type="radio" name="tech1" [value]="'NA'" [(ngModel)]="radioValues.tech1"></td>
                <td><input class="form-check-input" type="radio" name="tech1" [value]="'DEBUTANT'" [(ngModel)]="radioValues.tech1"></td>
                <td><input class="form-check-input" type="radio" name="tech1" [value]="'AUTONOME'" [(ngModel)]="radioValues.tech1"></td>
                <td><input class="form-check-input" type="radio" name="tech1" [value]="'AUTONOME+'" [(ngModel)]="radioValues.tech1"></td>
              </tr>
              <tr>
                <td>Etre capable analyser les besoins clients et traduire en spécifications techniques</td>
                <td><input class="form-check-input" type="radio" name="tech2" [value]="'NA'" [(ngModel)]="radioValues.tech2"></td>
                <td><input class="form-check-input" type="radio" name="tech2" [value]="'DEBUTANT'" [(ngModel)]="radioValues.tech2"></td>
                <td><input class="form-check-input" type="radio" name="tech2" [value]="'AUTONOME'" [(ngModel)]="radioValues.tech2"></td>
                <td><input class="form-check-input" type="radio" name="tech2" [value]="'AUTONOME+'" [(ngModel)]="radioValues.tech2"></td>
              </tr>
              <tr>
                <td>Etre capable participer à l'élaboration de prototypes et tests de validation</td>
                <td><input class="form-check-input" type="radio" name="tech3" [value]="'NA'" [(ngModel)]="radioValues.tech3"></td>
                <td><input class="form-check-input" type="radio" name="tech3" [value]="'DEBUTANT'" [(ngModel)]="radioValues.tech3"></td>
                <td><input class="form-check-input" type="radio" name="tech3" [value]="'AUTONOME'" [(ngModel)]="radioValues.tech3"></td>
                <td><input class="form-check-input" type="radio" name="tech3" [value]="'AUTONOME+'" [(ngModel)]="radioValues.tech3"></td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="p-3 border bg-light">
          <div class="mt-3">
            <label class="form-label">Note pour les compétences scientifiques et techniques
              <br>
              Donnez une note sur 20
            </label>
            <input type="number" class="form-control w-auto" min="0" max="20" [(ngModel)]="notes.technique" name="noteTechnique" placeholder="0 - 20">
          </div>
        </div>
      </div>
    </section>

    <!-- Section 6 -->
    <section *ngIf="currentStep === 6" class="mb-5">
      <div class="p-3 border bg-light">
        <h6 class="fw-bold">Compétences spécifiques métier (à ajouter selon besoin)</h6>
        <p class="mb-3">Évaluez chaque compétence avec un des trois niveaux suivants :
          <strong>DEBUTANT</strong>, <strong>AUTONOME</strong> ou <strong>AUTONOME +</strong>.
        </p>
        <div class="table-responsive">
          <table class="table table-bordered align-middle">
            <thead class="table-light text-center">
            <tr>
              <th style="width: 5%;">#</th>
              <th style="width: 50%;">Compétence</th>
              <th style="width: 45%;">Évaluation</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let comp of competencesSpecifiques; let i = index">
              <td class="text-center">{{i + 1}}</td>
              <td><input type="text" class="form-control" [(ngModel)]="comp.intitule" [name]="'competence' + i"></td>
              <td>
                <select class="form-select" [(ngModel)]="comp.valeur" [name]="'evaluation' + i">
                  <option value="">-- Sélectionner --</option>
                  <option value="NA">NA</option>
                  <option value="DEBUTANT">DEBUTANT</option>
                  <option value="AUTONOME">AUTONOME</option>
                  <option value="AUTONOME+">AUTONOME +</option>
                </select>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="p-3 border bg-light">
          <div class="mt-3">
            <label class="form-label">Note pour les compétences scientifique métier
              <br>
              Donnez une note sur 20
            </label>
            <input type="number" class="form-control w-auto" min="0" max="20" [(ngModel)]="notes.specifique" name="noteSpecifique" placeholder="0 - 20">
          </div>
        </div>
      </div>
    </section>

    <!-- Navigation buttons -->
    <div class="d-flex justify-content-between mt-4">
      <button type="button" class="btn btn-secondary"
              (click)="previousStep()"
              *ngIf="currentStep > 1">
        Précédent
      </button>
      <button type="button" class="btn btn-primary"
              (click)="nextStep()"
              *ngIf="!isLastStep()">
        Suivant
      </button>
      <button type="submit" class="btn btn-success"
              [disabled]="!isFormValid()"
              *ngIf="isLastStep()">
        Envoyer
      </button>
    </div>
  </form>
</div>
